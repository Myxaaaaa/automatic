# Платформа заявок на входящие деньги

Платформа для автоматического закрытия заявок по сумме из push-уведомлений Android приложения.

## Возможности

- ✅ Создание заявок на входящие деньги
- ✅ Автоматическое закрытие заявки при совпадении суммы из push-уведомления
- ✅ Ручное закрытие заявки
- ✅ Ручное отклонение заявки
- ✅ Автоматическое отклонение заявки через 15 минут, если не закрыта
- ✅ Веб-интерфейс для управления заявками
- ✅ Автообновление списка заявок каждые 5 секунд

## Установка

```bash
cd platform
npm install
```

## Запуск

```bash
npm start
```

Платформа будет доступна на `http://localhost:3001`

## Использование

### Веб-интерфейс

1. Откройте `http://localhost:3001` в браузере
2. Введите сумму и нажмите "Создать заявку"
3. Заявка появится в списке со статусом "Ожидание"
4. Заявка автоматически закроется при получении push-уведомления с совпадающей суммой
5. Или закройте/отклоните заявку вручную
6. Заявка автоматически отклонится через 15 минут, если не закрыта

### API

#### Создать заявку
```bash
POST /api/deal
Content-Type: application/json

{
  "amount": "1234,56"
}
```

#### Получить все заявки
```bash
GET /api/deals
```

#### Закрыть заявку вручную
```bash
POST /api/deal/:id/close
```

#### Отклонить заявку вручную
```bash
POST /api/deal/:id/reject
Content-Type: application/json

{
  "reason": "manual"
}
```

#### Принять уведомление от Android приложения
```bash
POST /notify
Authorization: Bearer test-secret
Content-Type: application/json

{
  "amount": "1234,56",
  "title": "Пополнение",
  "text": "Поступило 1234,56 руб",
  "package": "ru.example.bank",
  "postedAt": "2025-01-20T10:00:00Z"
}
```

## Подключение Android приложения

1. Запустите платформу
2. Узнайте IP адрес вашего компьютера в локальной сети
3. Создайте QR-код с JSON:
   ```json
   {"endpoint":"http://192.168.1.10:3001/notify","secret":"test-secret"}
   ```
   (замените `192.168.1.10` на ваш IP)
4. В Android приложении: меню → "Сканировать QR платформы"
5. Отсканируйте QR-код

## Настройка

Создайте файл `.env` для настройки:

```env
PORT=3001
SECRET=test-secret
```

По умолчанию:
- Порт: `3001`
- Секрет: `test-secret`
- Таймаут автоотклонения: `15 минут`

## Статусы заявок

- `pending` - Ожидание (активна, ожидает подтверждения)
- `confirmed` - Подтверждено (закрыта автоматически или вручную)
- `rejected` - Отклонено (вручную или по таймауту)

